# Telegram Integration –¥–ª—è UFO Service

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö –Ω–∞–±–ª—é–¥–µ–Ω–∏—è—Ö UFO.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
UFO Service
‚îú‚îÄ‚îÄ internal/client/http/telegram.go     - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è Telegram Bot API
‚îú‚îÄ‚îÄ internal/service/telegram/service.go - –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
‚îú‚îÄ‚îÄ internal/service/ufo/create.go       - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ UFO —Å–µ—Ä–≤–∏—Å
‚îî‚îÄ‚îÄ internal/app/di.go                   - DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. HTTP –ö–ª–∏–µ–Ω—Ç (`internal/client/http/telegram.go`)

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```go
type TelegramClient interface {
    SendMessage(ctx context.Context, chatID int64, text string) error
}
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫—É `github.com/go-telegram/bot`
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —á–∞—Ç
- –õ–æ–≥–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É

### 2. Telegram –°–µ—Ä–≤–∏—Å (`internal/service/telegram/service.go`)

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```go
type Service interface {
    SendUFONotification(ctx context.Context, uuid string, sighting model.SightingInfo) error
}
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ UFO
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ HTTP –∫–ª–∏–µ–Ω—Ç
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è –º–æ–¥–µ–ª–∏ `SightingInfo`

**–®–∞–±–ª–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è:**
```
üõ∏ **–ù–û–í–û–ï –ù–ê–ë–õ–Æ–î–ï–ù–ò–ï UFO!**

üÜî **ID:** `uuid`
üìç **–ú–µ—Å—Ç–æ:** location
üìù **–û–ø–∏—Å–∞–Ω–∏–µ:** description
üïê **–í—Ä–µ–º—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:** observed_at (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)
üé® **–¶–≤–µ—Ç:** color (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
üîä **–ó–≤—É–∫:** –î–∞/–ù–µ—Ç (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)
‚è±Ô∏è **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** duration —Å–µ–∫ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞)

üìÖ **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ:** current_timestamp
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ UFO –°–µ—Ä–≤–∏—Å

–í –º–µ—Ç–æ–¥–µ `Create` UFO —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

```go
func (s *service) Create(ctx context.Context, info model.SightingInfo) (string, error) {
    uuid, err := s.ufoRepository.Create(ctx, info)
    if err != nil {
        return "", err
    }

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
    if err := s.telegramService.SendUFONotification(ctx, uuid, info); err != nil {
        // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        log.Printf("Failed to send telegram notification for UFO %s: %v", uuid, err)
    }

    return uuid, nil
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ UFO
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ (–º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å)

### 4. DI –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä (`internal/app/di.go`)

**–ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```go
type diContainer struct {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
    telegramService service.TelegramService
    telegramClient  httpClient.TelegramClient
}
```

**–ú–µ—Ç–æ–¥—ã:**
- `TelegramClient(ctx)` - —Å–æ–∑–¥–∞–µ—Ç HTTP –∫–ª–∏–µ–Ω—Ç —Å —Ç–æ–∫–µ–Ω–æ–º
- `TelegramService(ctx)` - —Å–æ–∑–¥–∞–µ—Ç —Å–µ—Ä–≤–∏—Å —Å –∫–ª–∏–µ–Ω—Ç–æ–º –∏ chat ID
- `PartService(ctx)` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è Telegram —Å–µ—Ä–≤–∏—Å–∞

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í `internal/app/di.go` –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:

```go
const (
    telegramBotToken = "YOUR_TELEGRAM_BOT_TOKEN_HERE"
    telegramChatID   = -1001234567890 // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π chat ID
)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞:
1. –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω

### –ü–æ–ª—É—á–µ–Ω–∏–µ chat ID:

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Telegram**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram Web (web.telegram.org)
2. –í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç/–≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤ URL: `https://web.telegram.org/k/#-1001234567890`
4. –ß–∏—Å–ª–æ –ø–æ—Å–ª–µ `#` - —ç—Ç–æ chat ID

**–°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Bot API**
1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –µ–º—É –≤ –ª–∏—á–∫—É
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å: `https://api.telegram.org/bot{TOKEN}/getUpdates`
4. –ù–∞–π–¥–∏—Ç–µ `chat.id` –≤ –æ—Ç–≤–µ—Ç–µ

**–°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ @userinfobot**
1. –ù–∞–π–¥–∏—Ç–µ @userinfobot –≤ Telegram
2. –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ –≥—Ä—É–ø–ø—É –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ `/start`
3. –ë–æ—Ç –ø–æ–∫–∞–∂–µ—Ç chat ID

**–°–ø–æ—Å–æ–± 4: –ß–µ—Ä–µ–∑ curl**
```bash
curl "https://api.telegram.org/bot{YOUR_TOKEN}/getUpdates"
```

**–ü—Ä–∏–º–µ—Ä—ã chat ID:**
- –õ–∏—á–Ω—ã–π —á–∞—Ç: `123456789` (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ)
- –ì—Ä—É–ø–ø–∞: `-123456789` (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ)
- –°—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞/–∫–∞–Ω–∞–ª: `-1001234567890` (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å -100)

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
–ú–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π –ª–∏—á–Ω—ã–π chat ID - –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É `/start` –∏ –ø–æ–ª—É—á–∏—Ç–µ updates.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤ `go.mod`:
```
github.com/go-telegram/bot v1.15.0
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ chat ID** –≤ `di.go`
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å**
3. **–°–æ–∑–¥–∞–π—Ç–µ UFO —á–µ—Ä–µ–∑ API** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

–ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è UFO:
```bash
grpcurl -plaintext -d '{
  "info": {
    "location": "–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å",
    "description": "–Ø—Ä–∫–∏–π –æ–±—ä–µ–∫—Ç –≤ —Ñ–æ—Ä–º–µ –¥–∏—Å–∫–∞",
    "color": "–°–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π",
    "sound": true,
    "duration_seconds": 120
  }
}' localhost:50051 ufo.v1.UFOService/Create
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞: `Telegram message sent to chat {chatID}`
- –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: `Failed to send telegram notification for UFO {uuid}: {error}`

## –†–∞—Å—à–∏—Ä–µ–Ω–∏—è

–õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å:
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –¥–ª—è —Ç–æ–∫–µ–Ω–∞ –∏ chat ID
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É** —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏
- **Retry –º–µ—Ö–∞–Ω–∏–∑–º** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Markdown** –¥–ª—è –∫—Ä–∞—Å–∏–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Inline –∫–Ω–æ–ø–∫–∏** –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å UFO
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö** UFO
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∞—Ç—ã** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π 