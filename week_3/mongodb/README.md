# Примеры работы с MongoDB в Go

В этой директории содержатся примеры по работе с MongoDB из Go-приложения, демонстрирующие различные подходы к взаимодействию с базой данных.

## Структура проекта

```
week_3/mongodb/
├── cmd/                        # Исполняемые приложения
│   ├── raw_query/              # Пример с использованием "сырых" запросов MongoDB
│   └── query_with_mongo/       # Пример с использованием репозитория
├── internal/                   # Внутренние пакеты приложения
│   ├── model/                  # Модели данных
│   └── repository/             # Репозитории для работы с MongoDB
├── bin/                        # Директория для бинарных утилит
├── docker-compose.yml          # Конфигурация Docker Compose для MongoDB
├── Taskfile.yaml               # Файл задач для управления проектом
└── .golangci.yml               # Конфигурация линтера
```

## Примеры кода

В директории представлены два основных примера:

### 1. Работа с "сырыми" запросами MongoDB (raw_query)

Пример демонстрирует базовое взаимодействие с MongoDB с использованием официального драйвера MongoDB для Go. Показаны:
- Подключение к базе данных
- Создание индексов
- Выполнение базовых операций (вставка, поиск, обновление, удаление)
- Обработка результатов запросов
- Работа с BSON (Binary JSON)

### 2. Работа с репозиторием для MongoDB (query_with_mongo)

Пример демонстрирует более структурированный подход к работе с MongoDB через слой репозитория, который инкапсулирует логику доступа к данным. Показаны:
- Организация кода с использованием паттерна Repository
- Абстрагирование базовых операций с MongoDB
- Типобезопасный доступ к данным
- Обработка ошибок
- CRUD операции через методы репозитория

## Модель данных

В проекте используется схема коллекции `notes` со следующими полями:
- `_id` - уникальный идентификатор (ObjectID)
- `title` - заголовок заметки
- `body` - содержимое заметки
- `created_at` - время создания
- `updated_at` - время последнего обновления (опционально)

## Docker и Docker Compose

Проект включает настройки Docker Compose для быстрого развертывания MongoDB:
- Использует образ MongoDB 7.0
- Настраивает переменные окружения через .env-файл
- Монтирует том для сохранения данных
- Настраивает healthcheck и автоматический перезапуск

## Запуск примеров

### Подготовка

1. Создайте файл `.env` в корне директории или используйте команду:
```bash
task setup:env
```

Содержимое файла `.env`:
```
MONGO_USER=mongo
MONGO_PASSWORD=mongo
MONGO_PORT=27017
MONGO_URI=mongodb://mongo:mongo@localhost:27017/example?authSource=admin
```

2. Запустите MongoDB через Docker Compose:
```bash
task docker:compose:up
```

### Запуск примеров

1. Запуск примера с "сырыми" запросами:
```bash
go run cmd/raw_query/main.go
```

2. Запуск примера с репозиторием:
```bash
go run cmd/query_with_mongo/main.go
```

## Полезные команды (task)

- `task setup:env` - создает файл .env с настройками
- `task format` - форматирует код
- `task lint` - запускает линтер
- `task docker:compose:up` - запускает контейнеры Docker Compose
- `task docker:compose:down` - останавливает и удаляет контейнеры Docker Compose
- `task docker:compose:build` - пересобирает контейнеры Docker Compose

## Используемые технологии

- **mongo-driver** - официальный драйвер MongoDB для Go
- **bson** - библиотека для работы с BSON (Binary JSON)
- **godotenv** - загрузка переменных окружения из .env файла
- **gofakeit** - генерация тестовых данных 